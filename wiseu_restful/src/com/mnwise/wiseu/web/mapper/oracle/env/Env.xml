<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.Env">

   <resultMap id="resultDefaultHandler" type="DefaultHandler">
        <result column="seq"            property="seq"/>
        <result column="handle_nm"      property="handlerNm"/>
        <result column="handle_desc"    property="handlerDesc"/>
        <result column="service_type"   property="serviceType"/>
        <result column="channel"        property="channel"/>
        <result column="handle_type"    property="handleType"/>
        <result column="handle_attr"    property="handleAttr"/>
        <result column="user_id"        property="userId"/>
        <result column="create_dt"      property="createDt"/>
        <result column="create_tm"      property="createTm"/>
        <result column="handler"        property="handler"/>
        <result column="ab_test_yn"     property="abTestYn"/>
        <result column="msg_type"       property="msgType"/>
        <!--  ========== 추가 컬럼 ==========  -->
    </resultMap>

	<sql id="handlerListWhereQuery">
		<if test="serviceType == 'EM'">
        		AND (msg_type = 'C' OR service_type IS NULL)
        </if>
        <if test="serviceType != 'EM'">
            <if test="serviceType != null and serviceType != ''">
        		AND service_type = #{serviceType}
            </if>
        </if>
        <if test="handleType != null and handleType != ''">
	        AND handle_type = #{handleType}
        </if>
        <if test="handleAttr != null and handleAttr != ''">
	        AND handle_attr = #{handleAttr}
        </if>
        <if test="abTestYn != null and abTestYn != ''">
    	    and ab_test_yn = #{abTestYn}
        </if>
        <if test="channel != null and channel != ''">
        	AND channel = #{channel}
        </if>
        <if test="seq != null and seq != ''">
        	and seq = #{seq}
        </if>
	</sql>

	<select id="selectDefaultHandler" parameterType="DefaultHandler" resultMap="resultDefaultHandler">
        SELECT
            seq, handle_nm, handle_desc, service_type, channel, handle_attr, handle_type, user_id
          , to_char(to_date(create_dt, 'YYYY-MM-DD'),'YYYY-MM-DD') create_dt, to_char(to_date(create_tm, 'HH24:MI:SS'),'HH24:MI:SS') create_tm
          , handler, ab_test_yn, msg_type, 0 as total_rows
        FROM nvdefaulthandler
        WHERE 1 = 1
        <include refid="handlerListWhereQuery"/>
    </select>

</mapper>
